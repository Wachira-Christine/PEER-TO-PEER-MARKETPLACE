<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Details - StudentHub</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <nav class="top-nav">
            <div class="nav-brand">
                <span class="logo-icon">üéí</span>
                <span>StudentHub</span>
            </div>
            <div class="nav-actions">
                <button class="nav-btn secondary" onclick="window.location.href='home.html'">‚Üê Back</button>
                <button class="nav-btn primary" onclick="logout()">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div style="max-width: 900px; margin: 0 auto;">
                <div id="service-detail-container">
                    <!-- Service details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/services.js"></script>
    <script>
        async function initServiceDetail() {
            // Check authentication
            if (!await requireAuth()) return;

            // Get service ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const serviceId = urlParams.get('id');
            
            // check serviceId
            if (!serviceId) {
                window.location.href = 'home.html';
                return;
            }

            // Load service details
            const service = await loadServiceDetail(serviceId);
            if (!service) {
                alert('Service not found');
                window.location.href = 'home.html';
                return;
            }

            renderServiceDetail(service);
        }

        function renderServiceDetail(service) {
            const isOwnService = service.seller_id === currentUser.id;
            const container = document.getElementById('service-detail-container');

            container.innerHTML = `
                <div class="service-card" style="cursor: default;">
                    <div class="service-header">
                        <span class="service-icon">‚ö°</span>
                        <span class="service-category">${service.category}</span>
                    </div>
                    <div class="service-body" style="padding: 40px;">
                        <h2 class="service-title" style="font-size: 32px; margin-bottom: 20px;">${service.title}</h2>

                        <div style="background: var(--bg-cream); padding: 24px; border-radius: 16px; margin-bottom: 24px;">
                            <h3 style="margin-bottom: 12px; font-size: 18px;">Description</h3>
                            <p style="color: var(--text-gray); line-height: 1.8;">${service.description}</p>
                        </div>

                        <div style="background: var(--bg-cream); padding: 24px; border-radius: 16px; margin-bottom: 24px;">
                            <h3 style="margin-bottom: 16px; font-size: 18px;">Seller Information</h3>
                            <p style="margin-bottom: 8px;"><strong>Name:</strong> ${service.seller_name}</p>
                            <p style="margin-bottom: 8px;"><strong>Email:</strong> ${service.seller_email}</p>
                            ${service.seller_phone ? `<p style="margin-bottom: 8px;"><strong>Phone:</strong> ${service.seller_phone}</p>` : ''}
                            ${service.mpesa_number ? `<p style="margin-bottom: 8px;"><strong>M-Pesa:</strong> <span style="color: var(--accent); font-weight: 700;">${service.mpesa_number}</span></p>` : ''}
                            ${service.seller_description ? `<p style="margin-bottom: 8px;"><strong>About:</strong> ${service.seller_description}</p>` : ''}
                        </div>

                        <div class="service-footer" style="padding-top: 24px; margin-top: 24px;">
                            <div class="service-price" style="font-size: 36px;">KSh${service.price}</div>
                            ${!isOwnService ? `
                                <div style="display: flex; gap: 12px;">
                                    <button class="btn-request" onclick="requestServiceHandler(${service.id})">Request Service</button>
                                    <button class="btn-contact" onclick="startChat(${service.seller_id})">üí¨ Message</button>
                                </div>
                            ` : '<p style="color: var(--text-gray); font-style: italic;">This is your service</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        async function requestServiceHandler(serviceId) {
            const success = await requestService(serviceId);
            if (success) {
                // Optionally redirect to profile page to see the request
                window.location.href = 'profile.html?tab=requested';
            }
        }

        function startChat(userId) {
            window.location.href = `messages.html?user=${userId}`;
        }

        // Initialize service detail when page loads
        document.addEventListener('DOMContentLoaded', initServiceDetail);
    </script>
</body>
</html>
